<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Neon Commerce ‚Äî Full Experience</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&family=Orbitron:wght@600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#070a10;
      --card:#0f141c;
      --accent:#00e5ff;
      --accent-2:#7c3aed;
      --text:#e6f2ff;
      --muted:#8aa3c7;
    }
    *{font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial,sans-serif}
    body{ background:var(--bg); color:var(--text); overflow-x:hidden; }

    /* Ultra background: Animated aurora + holographic mesh + soft noise */
    .bg-stage{ position:fixed; inset:0; z-index:-2; overflow:hidden; }
    .aurora{
      position:absolute; inset:-20%;
      background:
        radial-gradient(40% 60% at 20% 30%, rgba(0,229,255,.25), transparent 70%),
        radial-gradient(40% 50% at 80% 60%, rgba(124,58,237,.22), transparent 70%),
        radial-gradient(30% 40% at 60% 20%, rgba(0,255,200,.16), transparent 70%);
      filter: blur(40px) saturate(1.1);
      animation: auroraFloat 18s ease-in-out infinite alternate;
      transform: translateZ(0);
    }
    @keyframes auroraFloat{
      0%{ transform: translate(-2%, -2%) scale(1); }
      50%{ transform: translate(3%, 1%) scale(1.06); }
      100%{ transform: translate(-1%, 3%) scale(1.03); }
    }

    .holo-mesh{
      position:absolute; inset:-10%;
      background: linear-gradient(45deg,
                rgba(0, 243, 255, 0.10) 0%,
                rgba(191, 0, 255, 0.10) 25%,
                rgba(255, 0, 150, 0.10) 50%,
                rgba(0, 255, 200, 0.10) 75%,
                rgba(0, 243, 255, 0.10) 100%);
      background-size: 400% 400%;
      mix-blend-mode: screen;
      animation: holographic-shift 6s ease-in-out infinite;
      filter:saturate(1.15);
    }
    @keyframes holographic-shift{
      0%,100%{ background-position: 0% 50%; }
      50%{ background-position: 100% 50%; }
    }

    .noize{
      position:absolute; inset:-5%;
      background-image: radial-gradient(rgba(255,255,255,.03) 1px, transparent 1px);
      background-size: 3px 3px;
      opacity:.5; pointer-events:none; mix-blend-mode:overlay;
      animation:noizeShift 22s linear infinite;
    }
    @keyframes noizeShift{
      from{ transform:translate3d(0,0,0); }
      to{ transform:translate3d(-30px,-20px,0); }
    }

    /* Neon typography glow */
    .brand{font-family:'Orbitron',sans-serif; letter-spacing:.5px}
    .neon{ color:var(--accent); text-shadow:0 0 8px rgba(0,229,255,.6), 0 0 18px rgba(0,229,255,.28); }

    /* Glass + soft halo */
    .glass{ background:rgba(16,23,34,.6); border:1px solid rgba(255,255,255,.06); backdrop-filter: blur(18px); }
    .halo{ position:relative; }
    .halo::before{
      content:""; position:absolute; inset:-2px; border-radius:18px; pointer-events:none;
      background:
        radial-gradient(150px 100px at 12% 8%, rgba(0,229,255,.22), transparent 60%),
        radial-gradient(220px 140px at 88% 92%, rgba(124,58,237,.20), transparent 60%),
        radial-gradient(240px 140px at 50% -10%, rgba(0,229,255,.12), transparent 70%);
      filter: blur(14px); opacity:.95;
    }

    /* 3) Holographic borders (removed spinning effect) */
    .holo-border{ border-radius:18px; }
    .holo-border::after{ content:none; }

    /* 2) Liquid/Gooey hover for buttons */
    .btn{
      position:relative; display:inline-flex; align-items:center; justify-content:center; gap:.55rem;
      font-weight:700; color:white; border-radius:14px; padding:.75rem 1rem;
      background:linear-gradient(45deg, var(--accent), var(--accent-2));
      background-size: 220% 220%;
      box-shadow:0 8px 28px rgba(0,229,255,.25), inset 0 0 0 1px rgba(255,255,255,.12);
      transition: transform .2s cubic-bezier(.2,.8,.3,1), box-shadow .28s, filter .28s, background-position .4s ease;
      overflow:hidden; isolation:isolate;
    }
    .btn:hover{ transform:translateY(-3px) scale(1.01); box-shadow:0 18px 48px rgba(0,229,255,.38); background-position: 100% 0; }
    .btn:active{ transform:translateY(-1px) scale(.995); box-shadow:0 12px 30px rgba(0,229,255,.28); }

    .btn-liquid::before, .btn-liquid::after{
      content:""; position:absolute; width:110px; height:110px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.5), rgba(255,255,255,.0) 60%);
      filter: blur(14px); opacity:.55; transform: translate(-140%, 40%);
      transition: transform .6s ease; mix-blend-mode: screen;
    }
    .btn-liquid::after{ width:140px; height:140px; transform: translate(160%, -60%); opacity:.4; }
    .btn-liquid:hover::before{ transform: translate(-10%, 10%); }
    .btn-liquid:hover::after{ transform: translate(20%, -20%); }

    .btn-ghost{
      position:relative; background:transparent; color:var(--text);
      border:1px solid rgba(255,255,255,.10); border-radius:14px; padding:.7rem 1rem; overflow:hidden;
      transition: border-color .25s, color .25s, transform .18s;
    }
    .btn-ghost::before{
      content:""; position:absolute; inset:0; border-radius:inherit; z-index:-1; pointer-events:none;
      background: linear-gradient(45deg, rgba(0,229,255,.12), rgba(124,58,237,.12)); opacity:0; transition: opacity .25s;
    }
    .btn-ghost:hover{ border-color:rgba(0,229,255,.45); color:var(--accent); transform: translateY(-2px); }
    .btn-ghost:hover::before{ opacity:1; }

    /* Chips and cards */
    .card{ background: rgba(16,23,34,.72); border:1px solid rgba(255,255,255,.06); transition: transform .25s cubic-bezier(.2,.8,.3,1), box-shadow .25s; }
    .card:hover{ transform: translateY(-8px) scale(1.01); box-shadow: 0 26px 70px rgba(0,229,255,.2); }
    .chip{ background: rgba(0,229,255,.10); color:#bfefff; border:1px solid rgba(0,229,255,.28); transition:transform .2s, box-shadow .25s; }
    .chip:hover{ transform: translateY(-2px); box-shadow:0 10px 28px rgba(0,229,255,.25); }

    /* Inputs */
    .input{
      background:#0d1219; border:1px solid rgba(255,255,255,.08); color:#dfe9ff; border-radius:14px; padding:.6rem .85rem;
      transition:border-color .2s, box-shadow .2s;
    }
    .input:focus{
      outline:none; border-color:rgba(0,229,255,.5);
      box-shadow:0 0 0 6px rgba(0,229,255,.15), 0 0 20px rgba(0,229,255,.15);
    }

    .thumb{ width:74px; height:74px; object-fit:cover; border-radius:12px; border:2px solid transparent; transition:.2s; cursor:pointer; }
    .thumb.active{ border-color:var(--accent); box-shadow:0 0 14px rgba(0,229,255,.45); }

    .stars{ color:#ffd54a; }
    .badge-off{ background:linear-gradient(45deg, #ef4444, #f472b6); color:white; }

    /* Banner mask and page reveal */
    .banner-mask{
      mask-image: linear-gradient(to bottom, black 70%, transparent);
      -webkit-mask-image: linear-gradient(to bottom, black 70%, transparent);
    }
    .notify{ position:fixed; top:86px; left:16px; z-index:80; transform:translateX(-30px); opacity:0; transition:.35s; }
    .notify.show{ transform:none; opacity:1; }

    .reveal{ opacity:0; transform: translateY(16px) scale(.985) rotateX(4deg); transform-origin: 50% 80%; filter: saturate(.9) blur(.2px); }
    .reveal.show{ animation:fadeUp .7s cubic-bezier(.22,.9,.27,1) forwards; }
    @keyframes fadeUp{
      0%{ opacity:0; transform: translateY(16px) scale(.985) rotateX(4deg); filter:saturate(.9) blur(.2px); }
      60%{ opacity:1; transform: translateY(0) scale(1.01) rotateX(0deg); filter:saturate(1.05); }
      100%{ opacity:1; transform: translateY(0) scale(1); filter:saturate(1); }
    }

    .grid-auto{ display:grid; grid-template-columns:repeat(auto-fit, minmax(260px, 1fr)); gap:1.2rem; }
    .modal{ position:fixed; inset:0; background:rgba(0,0,0,.70); backdrop-filter:blur(10px); display:none; align-items:center; justify-content:center; z-index:60; }
    .modal.show{ display:flex; }

    .search-dd{ position:absolute; right:0; left:0; top:110%; background:rgba(16,23,34,.96); border:1px solid rgba(255,255,255,.06); border-radius:16px; overflow:hidden; display:none; }
    .search-dd.show{ display:block; }
    .section{ padding-top: 1rem; }

    /* Fullscreen Signup Wizard */
    .wizard-modal{ position:fixed; inset:0; z-index:70; display:none; }
    .wizard-modal.show{ display:block; }
    .wizard-backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.6); backdrop-filter: blur(10px); }
    .wizard-panel{
      position:absolute; top:50%; left:50%; transform: translate(-50%,-50%);
      width:min(92vw, 860px);
    }
    .step-dot{ width:10px; height:10px; border-radius:9999px; background:#2b3342; }
    .step-dot.active{ background:var(--accent); box-shadow:0 0 12px rgba(0,229,255,.6); }

    /* Country list scroll */
    .scroll-y{ max-height: 320px; overflow-y: auto; }
    .flag{ font-size:20px; }

    /* Navbar precise spacing */
    .nav-links a{ position:relative; }
    .nav-links{ gap:14px; } /* pixel-precise spacing */

    /* 8) Mini Cart */
    .mini{ animation: miniIn .18s ease; }
    @keyframes miniIn{ from{opacity:0; transform: translateY(-6px);} to{opacity:1; transform: translateY(0);} }

    /* 13) Skeleton loading */
    .skeleton{ position:relative; overflow:hidden; }
    .skeleton::after{
      content:""; position:absolute; inset:0; background: linear-gradient(90deg, transparent, rgba(255,255,255,.06), transparent);
      transform: translateX(-100%); animation: shimmer 1.1s infinite;
    }
    @keyframes shimmer{ to{ transform: translateX(100%);} }

    /* Canvas for particles sits in hero */
    #particleLayer{ mix-blend-mode: screen; }
  </style>
</head>
<body>
  <!-- Background Stage -->
  <div class="bg-stage">
    <div class="aurora"></div>
    <div class="holo-mesh"></div>
    <div class="noize"></div>
  </div>

  <!-- Toast -->
  <div id="notify" class="notify glass px-4 py-3 rounded-xl shadow-lg"></div>

  <!-- Navbar -->
  <nav class="sticky top-0 z-50 glass">
    <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <div class="text-2xl brand neon">test</div>
        <div class="nav-links hidden md:flex text-[15px] text-[color:var(--muted)] items-center">
          <a href="#" onclick="showPage('home')" class="hover:text-[color:var(--accent)] px-[6px] py-[4px] rounded-md">Home</a>
          <a href="#" onclick="showPage('categories')" class="hover:text-[color:var(--accent)] px-[6px] py-[4px] rounded-md">Categories</a>
          <a href="#" onclick="showPage('deals')" class="hover:text-[color:var(--accent)] px-[6px] py-[4px] rounded-md">Deals</a>
          <a href="#" onclick="showPage('cart')" class="hover:text-[color:var(--accent)] px-[6px] py-[4px] rounded-md">Cart</a>
          <a href="#" id="accountNav" onclick="openAccount()" class="hover:text-[color:var(--accent)] px-[6px] py-[4px] rounded-md">Profile (Demo)</a>
        </div>
      </div>

      <!-- Search -->
      <div class="relative w-full max-w-lg hidden md:block">
        <input id="searchInput" class="input w-full pr-10" placeholder="Search products..."
               oninput="handleSearch(this.value)" onfocus="showSearchResults()" onblur="hideSearchResults()"/>
        <span class="absolute right-3 top-2.5 text-[18px]">üîç</span>
        <div id="searchResults" class="search-dd"></div>
      </div>

      <!-- Actions + Mini Cart -->
      <div class="flex items-center gap-[10px]">
        <button id="accountBtn" class="btn-ghost px-4 py-2 rounded-xl hidden sm:inline-flex" onclick="openAccount()">
          Account
        </button>

        <div id="cartWrap" class="relative" onmouseenter="showMiniCart()" onmouseleave="hideMiniCart()">
          <button id="cartBtn" class="relative chip px-3 py-2 rounded-full hover:brightness-110" onclick="showPage('cart')">
            üõí
            <span id="cartCount" class="absolute -top-2 -left-2 text-xs bg-red-500 rounded-full px-1.5 py-0.5">0</span>
          </button>
          <div id="miniCart" class="absolute right-0 mt-2 w-80 hidden glass halo holo-border rounded-2xl p-3 shadow-xl mini">
            <div id="miniCartItems" class="space-y-2 max-h-72 overflow-auto"></div>
            <div class="flex items-center justify-between mt-3">
              <span class="text-sm text-[color:var(--muted)]">Total</span>
              <span id="miniCartTotal" class="font-extrabold neon">$0.00</span>
            </div>
            <div class="grid grid-cols-2 gap-2 mt-3">
              <button class="btn-ghost" onclick="showPage('cart'); hideMiniCart()">View cart</button>
              <button class="btn btn-liquid" onclick="showPage('cart'); hideMiniCart()">Checkout</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <main class="max-w-7xl mx-auto px-4 section">
    <!-- HOME -->
    <section id="home" class="space-y-8">
      <!-- 1) 3D Parallax Hero + Particles + Slider -->
      <div class="relative rounded-2xl overflow-hidden halo banner-mask reveal holo-border">
        <div id="banner" class="relative h-[260px] sm:h-[360px] lg:h-[420px]"></div>
        <canvas id="particleLayer" class="absolute inset-0 pointer-events-none"></canvas>
        <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex items-center gap-2">
          <button class="w-9 h-9 rounded-full glass flex items-center justify-center text-lg hover:scale-105" onclick="prevSlide()">‚Äπ</button>
          <div id="dots" class="flex items-center gap-2"></div>
          <button class="w-9 h-9 rounded-full glass flex items-center justify-center text-lg hover:scale-105" onclick="nextSlide()">‚Ä∫</button>
        </div>
      </div>

      <!-- Filters -->
      <div class="glass halo rounded-2xl p-5 reveal holo-border">
        <h3 class="text-xl font-extrabold neon text-center mb-4">Browse by category</h3>
        <div class="flex flex-wrap items-center gap-3 justify-center">
          <button class="chip px-4 py-2 rounded-full" onclick="filterProducts('all')">All</button>
          <button class="chip px-4 py-2 rounded-full" onclick="filterProducts('electronics')">Electronics</button>
          <button class="chip px-4 py-2 rounded-full" onclick="filterProducts('fashion')">Fashion</button>
          <button class="chip px-4 py-2 rounded-full" onclick="filterProducts('books')">Books</button>
          <button class="chip px-4 py-2 rounded-full" onclick="filterProducts('home')">Home & Kitchen</button>
        </div>
      </div>

      <!-- 13) Skeleton + Products grid -->
      <div id="skeletonGrid" class="grid-auto reveal">
        <div class="rounded-2xl p-4 glass h-64 skeleton"></div>
        <div class="rounded-2xl p-4 glass h-64 skeleton"></div>
        <div class="rounded-2xl p-4 glass h-64 skeleton"></div>
        <div class="rounded-2xl p-4 glass h-64 skeleton"></div>
      </div>
      <div id="productsGrid" class="grid-auto reveal hidden"></div>
    </section>

    <!-- CATEGORIES -->
    <section id="categories" class="hidden space-y-6">
      <h2 class="text-2xl font-extrabold neon reveal">Categories</h2>
      <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-5">
        <div class="card rounded-2xl p-6 hover:cursor-pointer halo reveal holo-border" onclick="filterProducts('electronics');showPage('home')">
          <div class="text-5xl mb-3">üì±</div>
          <div class="text-xl font-bold mb-1">Electronics</div>
          <div class="text-[color:var(--muted)]">Phones, laptops, headphones and more</div>
        </div>
        <div class="card rounded-2xl p-6 hover:cursor-pointer halo reveal holo-border" onclick="filterProducts('fashion');showPage('home')">
          <div class="text-5xl mb-3">üëó</div>
          <div class="text-xl font-bold mb-1">Fashion</div>
          <div class="text-[color:var(--muted)]">Clothes, shoes, and accessories</div>
        </div>
        <div class="card rounded-2xl p-6 hover:cursor-pointer halo reveal holo-border" onclick="filterProducts('books');showPage('home')">
          <div class="text-5xl mb-3">üìö</div>
          <div class="text-xl font-bold mb-1">Books</div>
          <div class="text-[color:var(--muted)]">Fiction, tech, and knowledge</div>
        </div>
        <div class="card rounded-2xl p-6 hover:cursor-pointer halo reveal holo-border" onclick="filterProducts('home');showPage('home')">
          <div class="text-5xl mb-3">üè†</div>
          <div class="text-xl font-bold mb-1">Home</div>
          <div class="text-[color:var(--muted)]">Appliances & kitchen</div>
        </div>
      </div>
    </section>

    <!-- DEALS -->
    <section id="deals" class="hidden space-y-6">
      <h2 class="text-2xl font-extrabold neon reveal">Hot Deals</h2>
      <div id="dealsGrid" class="grid-auto reveal"></div>
    </section>

    <!-- CART & CHECKOUT -->
    <section id="cart" class="hidden space-y-6">
      <h2 class="text-2xl font-extrabold neon reveal">Cart & Checkout</h2>
      <div class="grid lg:grid-cols-3 gap-5">
        <div class="lg:col-span-2 glass halo rounded-2xl p-5 reveal holo-border">
          <h3 class="font-bold text-lg mb-3">Your Items</h3>
          <div id="cartItems"></div>
        </div>

        <div class="glass halo rounded-2xl p-5 reveal holo-border">
          <h3 class="font-bold text-lg mb-3">Checkout (Demo)</h3>
          <p class="text-sm text-yellow-200/90 mb-3">Demo only ‚Äî no real payments.</p>
          <form onsubmit="event.preventDefault(); placeOrder();" class="space-y-3">
            <div>
              <label class="text-sm text-[color:var(--muted)]">Full name</label>
              <input class="input w-full mt-1" required/>
            </div>
            <div class="grid sm:grid-cols-2 gap-3">
              <div>
                <label class="text-sm text-[color:var(--muted)]">Phone</label>
                <input class="input w-full mt-1" required/>
              </div>
              <div>
                <label class="text-sm text-[color:var(--muted)]">City</label>
                <input class="input w-full mt-1" required/>
              </div>
            </div>
            <div>
              <label class="text-sm text-[color:var(--muted)]">Address</label>
              <textarea class="input w-full mt-1 h-24" required></textarea>
            </div>
            <div class="flex items-center justify-between pt-2">
              <span class="text-[color:var(--muted)]">Total</span>
              <span id="cartTotal" class="text-2xl font-extrabold neon">$0.00</span>
            </div>
            <button class="btn btn-liquid w-full">Place order</button>
          </form>
        </div>
      </div>
    </section>

    <!-- ACCOUNT SETTINGS (visible after signup) -->
    <section id="account" class="hidden space-y-6">
      <h2 class="text-2xl font-extrabold neon reveal">Account Settings</h2>
      <div class="glass halo rounded-2xl p-5 max-w-2xl reveal holo-border">
        <form id="accountForm" onsubmit="event.preventDefault(); saveAccountSettings();" class="space-y-4">
          <div class="grid sm:grid-cols-3 gap-3">
            <div class="sm:col-span-1">
              <label class="text-sm text-[color:var(--muted)]">Country</label>
              <input id="accCountry" class="input w-full mt-1" readonly/>
            </div>
            <div class="sm:col-span-2">
              <label class="text-sm text-[color:var(--muted)]">Phone</label>
              <input id="accPhone" class="input w-full mt-1" required/>
            </div>
          </div>
          <div>
            <label class="text-sm text-[color:var(--muted)]">Backup Gmail</label>
            <input id="accEmail" class="input w-full mt-1" type="email" required/>
          </div>
          <div>
            <label class="text-sm text-[color:var(--muted)]">Display name</label>
            <input id="accName" class="input w-full mt-1" required/>
          </div>
          <div class="flex items-center gap-3">
            <button class="btn btn-liquid">Save changes</button>
            <button class="btn-ghost" onclick="signOut()">Sign out</button>
          </div>
        </form>
      </div>
    </section>
  </main>

  <!-- PRODUCT MODAL -->
  <div id="productModal" class="modal">
    <div class="glass rounded-2xl p-6 w-[95vw] max-w-5xl max-h-[92vh] overflow-y-auto relative holo-border">
      <button class="absolute top-3 right-4 text-2xl hover:opacity-80" onclick="closeProductModal()">‚úï</button>
      <div id="productModalContent"></div>
    </div>
  </div>

  <!-- FULLSCREEN SIGNUP WIZARD -->
  <div id="signupModal" class="wizard-modal">
    <div class="wizard-backdrop" onclick="closeSignup()"></div>
    <div class="wizard-panel">
      <div class="glass halo rounded-2xl p-5 holo-border">
        <div class="flex items-center justify-between mb-4">
          <div class="text-xl font-extrabold neon">Create your account</div>
          <button class="btn-ghost rounded-xl px-3 py-2" onclick="closeSignup()">Close</button>
        </div>

        <!-- Steps indicator -->
        <div class="flex items-center gap-3 mb-5">
          <div class="step-dot" id="dot1"></div><span class="text-sm">Country & Phone</span>
          <div class="flex-1 h-[1px] bg-white/10 mx-2"></div>
          <div class="step-dot" id="dot2"></div><span class="text-sm">Backup Gmail</span>
          <div class="flex-1 h-[1px] bg-white/10 mx-2"></div>
          <div class="step-dot" id="dot3"></div><span class="text-sm">Display name</span>
        </div>

        <!-- Step 1 -->
        <div id="step1" class="space-y-4">
          <div>
            <label class="text-sm text-[color:var(--muted)]">Search country</label>
            <input id="countrySearch" class="input w-full mt-1" placeholder="Type a country name..." oninput="filterCountries(this.value)"/>
          </div>
          <div class="grid sm:grid-cols-2 gap-3">
            <div class="sm:col-span-2">
              <label class="text-sm text-[color:var(--muted)]">Country</label>
              <div class="relative mt-1">
                <button id="countryDropdownBtn" class="input w-full text-left flex items-center justify-between" onclick="toggleCountryMenu(event)">
                  <span class="flex items-center gap-2">
                    <span id="selFlag" class="flag">üè≥Ô∏è</span>
                    <span id="selCountry">Select a country</span>
                  </span>
                  <span class="text-lg">‚ñæ</span>
                </button>
                <div id="countryMenu" class="absolute z-10 left-0 right-0 mt-2 max-h-64 overflow-auto glass rounded-xl hidden">
                  <input id="countrySearch" class="input w-full rounded-xl !rounded-b-none" placeholder="Type a country name..." oninput="filterCountries(this.value)"/>
                  <div id="countryList" class="max-h-56 overflow-auto"></div>
                </div>
              </div>
            </div>
            <div class="sm:col-span-2">
              <label class="text-sm text-[color:var(--muted)]">Phone number</label>
              <div class="flex items-center gap-2 mt-1">
                <span id="selDial" class="chip rounded-full px-2 py-0.5 text-sm">+‚Äî</span>
                <input id="phoneInput" class="input w-full" placeholder="e.g., 555123456" inputmode="numeric" pattern="[0-9]{6,15}" required/>
              </div>
            </div>
            <div class="sm:col-span-2">
              <button class="btn btn-liquid w-full" onclick="nextFromStep1()">Continue</button>
            </div>
          </div>
        </div>

        <!-- Step 2 -->
        <div id="step2" class="space-y-4 hidden">
          <div>
            <label class="text-sm text-[color:var(--muted)]">Backup Gmail</label>
            <input id="emailInput" class="input w-full mt-1" placeholder="yourname@gmail.com" type="email" required/>
            <p class="text-xs text-[color:var(--muted)] mt-1">We‚Äôll use this only for account recovery.</p>
          </div>
          <div class="flex items-center gap-3">
            <button class="btn-ghost" onclick="prevToStep1()">Back</button>
            <button class="btn btn-liquid" onclick="nextFromStep2()">Continue</button>
          </div>
        </div>

        <!-- Step 3 -->
        <div id="step3" class="space-y-4 hidden">
          <div>
            <label class="text-sm text-[color:var(--muted)]">Display name</label>
            <input id="nameInput" class="input w-full mt-1" placeholder="e.g., Alex" maxlength="24" required/>
          </div>
          <div class="flex items-center gap-3">
            <button class="btn-ghost" onclick="prevToStep2()">Back</button>
            <button class="btn btn-liquid" onclick="finishSignup()">Create account</button>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    // DISCLAIMER: Demo-only account flow (no passwords, no persistence). Reviews require a display name during this session.

    // Products (40)
    const products = [
      { id:1, name:'Samsung Galaxy S23', price:999, category:'electronics', image:'https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=900', discount:15 },
      { id:2, name:'ASUS VivoBook 15', price:799, category:'electronics', image:'https://images.unsplash.com/photo-1496181133206-80ce9b88a853?w=900', discount:0 },
      { id:3, name:'Sony WH-1000XM5', price:349, category:'electronics', image:'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=900', discount:10 },
      { id:4, name:'Apple Watch Series 9', price:399, category:'electronics', image:'https://images.unsplash.com/photo-1434493789847-2f02dc6ca35d?w=900', discount:5 },
      { id:5, name:'Apple iPad Pro 12.9"', price:1099, category:'electronics', image:'https://images.unsplash.com/photo-1544244015-0df4b3ffc6b0?w=900', discount:8 },
      { id:6, name:'Canon EOS R6', price:2499, category:'electronics', image:'https://images.unsplash.com/photo-1502920917128-1aa500764cbd?w=900', discount:12 },
      { id:7, name:'PlayStation 5', price:499, category:'electronics', image:'https://images.unsplash.com/photo-1606813907291-d86efa9b94db?w=900', discount:0 },
      { id:8, name:'JBL Go Extreme', price:149, category:'electronics', image:'https://images.unsplash.com/photo-1608043152269-423dbba4e7e1?w=900', discount:20 },
      { id:9, name:'27" 165Hz Gaming Monitor', price:349, category:'electronics', image:'https://images.unsplash.com/photo-1527443224154-c4a3942d3acf?w=900', discount:15 },
      { id:10, name:'RGB Mechanical Keyboard', price:129, category:'electronics', image:'https://images.unsplash.com/photo-1541140532154-b024d705b90a?w=900', discount:25 },

      { id:11, name:'Men Cotton T‚ÄëShirt', price:29, category:'fashion', image:'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=900', discount:20 },
      { id:12, name:'Nike Running Shoes', price:129, category:'fashion', image:'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=900', discount:25 },
      { id:13, name:'Women Evening Dress', price:89, category:'fashion', image:'https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?w=900', discount:30 },
      { id:14, name:'Men Denim Jeans', price:69, category:'fashion', image:'https://images.unsplash.com/photo-1542272604-787c3835535d?w=900', discount:15 },
      { id:15, name:'Formal Business Suit', price:299, category:'fashion', image:'https://images.unsplash.com/photo-1594938298603-c8148c4dae35?w=900', discount:10 },
      { id:16, name:'Leather Dress Shoes', price:149, category:'fashion', image:'https://images.unsplash.com/photo-1449824913935-59a10b8d2000?w=900', discount:0 },
      { id:17, name:'Women Silk Blouse', price:49, category:'fashion', image:'https://images.unsplash.com/photo-1551698618-1dfe5d97d256?w=900', discount:18 },
      { id:18, name:'Winter Jacket', price:199, category:'fashion', image:'https://images.unsplash.com/photo-1544966503-7cc5ac882d5f?w=900', discount:22 },
      { id:19, name:'Scarf & Hat Set', price:39, category:'fashion', image:'https://images.unsplash.com/photo-1520903920243-00d872a2d1c9?w=900', discount:35 },
      { id:20, name:'Sports Watch', price:79, category:'fashion', image:'https://images.unsplash.com/photo-1524592094714-0f0654e20314?w=900', discount:12 },

      { id:21, name:'The Art of Living', price:19, category:'books', image:'https://images.unsplash.com/photo-1544947950-fa07a98d237f?w=900', discount:0 },
      { id:22, name:'Python Programming Guide', price:29, category:'books', image:'https://images.unsplash.com/photo-1532012197267-da84d127e765?w=900', discount:15 },
      { id:23, name:'One Hundred Years of Solitude', price:16, category:'books', image:'https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=900', discount:10 },
      { id:24, name:'World History Encyclopedia', price:39, category:'books', image:'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=900', discount:5 },
      { id:25, name:'International Cookbook', price:24, category:'books', image:'https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?w=900', discount:20 },
      { id:26, name:'Psychology of Success', price:22, category:'books', image:'https://images.unsplash.com/photo-1589829085413-56de8ae18c73?w=900', discount:8 },
      { id:27, name:'Classic Poetry Collection', price:14, category:'books', image:'https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=900', discount:0 },
      { id:28, name:'Time Management Mastery', price:18, category:'books', image:'https://images.unsplash.com/photo-1553729459-efe14ef6055d?w=900', discount:25 },
      { id:29, name:'Machine Learning Handbook', price:49, category:'books', image:'https://images.unsplash.com/photo-1516979187457-637abb4f9353?w=900', discount:12 },
      { id:30, name:'Philosophy of Life', price:26, category:'books', image:'https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=900', discount:18 },

      { id:31, name:'Espresso Coffee Machine', price:299, category:'home', image:'https://images.unsplash.com/photo-1559056199-641a0ac8b55e?w=900', discount:0 },
      { id:32, name:'Microwave Oven', price:199, category:'home', image:'https://images.unsplash.com/photo-1574269909862-7e1d70bb8078?w=900', discount:15 },
      { id:33, name:'LG Refrigerator', price:899, category:'home', image:'https://images.unsplash.com/photo-1571175443880-49e1d25b2bc5?w=900', discount:8 },
      { id:34, name:'Washing Machine', price:649, category:'home', image:'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=900', discount:10 },
      { id:35, name:'Robot Vacuum Cleaner', price:399, category:'home', image:'https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?w=900', discount:20 },
      { id:36, name:'12-Piece Cookware Set', price:149, category:'home', image:'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=900', discount:25 },
      { id:37, name:'Electric Tea Maker', price:79, category:'home', image:'https://images.unsplash.com/photo-1544787219-7f47ccb76574?w=900', discount:12 },
      { id:38, name:'28-Piece Dinnerware Set', price:129, category:'home', image:'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=900', discount:18 },
      { id:39, name:'Juice Extractor', price:89, category:'home', image:'https://images.unsplash.com/photo-1610736969858-0c2e4d4d5d2e?w=900', discount:30 },
      { id:40, name:'Water Purifier', price:249, category:'home', image:'https://images.unsplash.com/photo-1563453392212-326f5e854473?w=900', discount:5 }
    ];

    // Countries (popular set with flags and dialing codes)
    const countries = [
      {name:'United States', code:'US', dial:'+1', flag:'üá∫üá∏'},
      {name:'Canada', code:'CA', dial:'+1', flag:'üá®üá¶'},
      {name:'Mexico', code:'MX', dial:'+52', flag:'üá≤üáΩ'},
      {name:'Brazil', code:'BR', dial:'+55', flag:'üáßüá∑'},
      {name:'Argentina', code:'AR', dial:'+54', flag:'üá¶üá∑'},
      {name:'United Kingdom', code:'GB', dial:'+44', flag:'üá¨üáß'},
      {name:'Germany', code:'DE', dial:'+49', flag:'üá©üá™'},
      {name:'France', code:'FR', dial:'+33', flag:'üá´üá∑'},
      {name:'Spain', code:'ES', dial:'+34', flag:'üá™üá∏'},
      {name:'Italy', code:'IT', dial:'+39', flag:'üáÆüáπ'},
      {name:'Netherlands', code:'NL', dial:'+31', flag:'üá≥üá±'},
      {name:'Sweden', code:'SE', dial:'+46', flag:'üá∏üá™'},
      {name:'Norway', code:'NO', dial:'+47', flag:'üá≥üá¥'},
      {name:'Russia', code:'RU', dial:'+7', flag:'üá∑üá∫'},
      {name:'Turkey', code:'TR', dial:'+90', flag:'üáπüá∑'},
      {name:'Saudi Arabia', code:'SA', dial:'+966', flag:'üá∏üá¶'},
      {name:'United Arab Emirates', code:'AE', dial:'+971', flag:'üá¶üá™'},
      {name:'Qatar', code:'QA', dial:'+974', flag:'üá∂üá¶'},
      {name:'Kuwait', code:'KW', dial:'+965', flag:'üá∞üáº'},
      {name:'Oman', code:'OM', dial:'+968', flag:'üá¥üá≤'},
      {name:'Iran', code:'IR', dial:'+98', flag:'üáÆüá∑'},
      {name:'Iraq', code:'IQ', dial:'+964', flag:'üáÆüá∂'},
      {name:'Afghanistan', code:'AF', dial:'+93', flag:'üá¶üá´'},
      {name:'Pakistan', code:'PK', dial:'+92', flag:'üáµüá∞'},
      {name:'India', code:'IN', dial:'+91', flag:'üáÆüá≥'},
      {name:'Bangladesh', code:'BD', dial:'+880', flag:'üáßüá©'},
      {name:'Sri Lanka', code:'LK', dial:'+94', flag:'üá±üá∞'},
      {name:'China', code:'CN', dial:'+86', flag:'üá®üá≥'},
      {name:'Japan', code:'JP', dial:'+81', flag:'üáØüáµ'},
      {name:'South Korea', code:'KR', dial:'+82', flag:'üá∞üá∑'},
      {name:'Singapore', code:'SG', dial:'+65', flag:'üá∏üá¨'},
      {name:'Malaysia', code:'MY', dial:'+60', flag:'üá≤üáæ'},
      {name:'Indonesia', code:'ID', dial:'+62', flag:'üáÆüá©'},
      {name:'Thailand', code:'TH', dial:'+66', flag:'üáπüá≠'},
      {name:'Philippines', code:'PH', dial:'+63', flag:'üáµüá≠'},
      {name:'Australia', code:'AU', dial:'+61', flag:'üá¶üá∫'},
      {name:'New Zealand', code:'NZ', dial:'+64', flag:'üá≥üáø'},
      {name:'South Africa', code:'ZA', dial:'+27', flag:'üáøüá¶'},
      {name:'Egypt', code:'EG', dial:'+20', flag:'üá™üá¨'},
      {name:'Morocco', code:'MA', dial:'+212', flag:'üá≤üá¶'},
      {name:'Nigeria', code:'NG', dial:'+234', flag:'üá≥üá¨'},
      {name:'Kenya', code:'KE', dial:'+254', flag:'üá∞üá™'}
    ];

    // State
    let cart = [];
    let currentFilter = 'all';
    let currentUser = null; // {country, dial, phone, email, name}
    let displayName = '';   // used for reviews; not persisted

    // Reviews (local)
    const reviewsStore = JSON.parse(localStorage.getItem('reviewsStore') || '{}');

    // Enrich products with defaults and seeded reviews + different gallery images
    function enrichProducts(){
      const defaults = {
        electronics: { description:'High‚Äëperformance electronics with premium build quality for daily and pro use.', specs:{ Warranty:'18 months', Origin:'Varies', Color:'Black/Silver', Connectivity:'Bluetooth/USB/Wi‚ÄëFi' } },
        fashion:{ description:'Comfortable fabrics with clean stitching and modern fit.', specs:{ Material:'Cotton/Polyester', Sizes:'S‚ÄìXL', Care:'Machine or hand wash', Cut:'Standard' } },
        books:{ description:'Quality print with engaging, helpful content for curious readers.', specs:{ Format:'Paperback', Pages:'200‚Äì400', Language:'English', Print:'High quality' } },
        home:{ description:'Durable and stylish home appliance to simplify your day.', specs:{ Energy:'Low consumption', Warranty:'12 months', Material:'ABS/Steel', Voltage:'220‚Äì240V' } }
      };
      // Build per-category pool to pick distinct images for each product gallery
      const catPools = products.reduce((acc,p)=>((acc[p.category] ||= []).push(p.image), acc), {});
      products.forEach(p=>{
        const def = defaults[p.category] || { description:'Great quality product.', specs:{} };
        if(!p.description) p.description = def.description;
        if(!p.specifications) p.specifications = def.specs;

        // Distinct gallery: main + 2 others from same category
        const pool = catPools[p.category] || [];
        if(pool.length >= 3){
          const idx = pool.indexOf(p.image);
          p.images = [p.image, pool[(idx+1)%pool.length], pool[(idx+2)%pool.length]];
        }else{
          p.images = [p.image];
        }

        if(!reviewsStore[p.id] || !Array.isArray(reviewsStore[p.id])){
          const r1 = (p.id % 5) + 1;
          const r2 = ((p.id + 2) % 5) + 1;
          reviewsStore[p.id] = [
            { userName:'Guest', rating:r1, date:'2024-12-12', comment:`${p.name} has solid quality and worth the price.` },
            { userName:'Alex', rating:r2, date:'2025-01-20', comment:'Fast delivery and decent packaging.' }
          ];
        }
      });
      localStorage.setItem('reviewsStore', JSON.stringify(reviewsStore));
    }

    function avgRatingFor(id){
      const r = reviewsStore[id] || [];
      if(r.length===0) return 4.5;
      const sum = r.reduce((a,c)=>a+(c.rating||0),0);
      return Math.round((sum/r.length)*10)/10;
    }
    function stars(rate){
      const full = Math.floor(rate);
      const hasHalf = (rate % 1) !== 0;
      let s=''; for(let i=0;i<full;i++) s+='‚≠ê';
      if(hasHalf) s+='‚≠ê';
      for(let i=full+(hasHalf?1:0); i<5; i++) s+='‚òÜ';
      return s;
    }

    // Navigation
    function showPage(id){
      ['home','categories','deals','cart','account'].forEach(pid=>{
        const el = document.getElementById(pid);
        if(!el) return;
        const hidden = pid!==id;
        el.classList.toggle('hidden', hidden);
        if(!hidden){
          el.querySelectorAll('.reveal').forEach((n,i)=> setTimeout(()=> n.classList.add('show'), 40*i));
        }
      });
      if(id==='deals') renderDeals();
      if(id==='cart') updateCartUI();
      if(id==='account') fillAccountSettings();
    }

    // Open Account: if not signed in -> open signup, else -> go to settings
    function openAccount(){
      if(!currentUser){ openSignup(); }
      else{ showPage('account'); }
    }

    // Search with suggestions
    let searchTimeout;
    function handleSearch(q){
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(()=>{
        const box = document.getElementById('searchResults');
        if(!q || q.trim().length<2){ box.classList.remove('show'); box.innerHTML=''; return; }
        const list = products.filter(p=>{
          const t = q.toLowerCase();
          return p.name.toLowerCase().includes(t) || p.category.toLowerCase().includes(t);
        }).slice(0,10);
        box.innerHTML = list.map(p=>{
          const dp = p.discount ? p.price - p.price*p.discount/100 : p.price;
          return `
            <div class="flex items-center gap-3 p-2 hover:bg-white/5 cursor-pointer" onclick="selectSearch(${p.id})">
              <img src="${p.image}" alt="${p.name}" class="w-12 h-12 rounded-lg object-cover"
                   onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
              <div class="flex-1 min-w-0">
                <div class="truncate">${p.name}</div>
                <div class="text-xs text-[color:var(--muted)]">${p.category} ‚Ä¢ <span class="neon">$${dp.toFixed(2)}</span></div>
              </div>
            </div>
          `;
        }).join('') || `<div class="p-3 text-sm text-[color:var(--muted)]">No results</div>`;
        box.classList.add('show');
      }, 220);
    }
    function showSearchResults(){ const b=document.getElementById('searchResults'); if(b.innerHTML) b.classList.add('show'); }
    function hideSearchResults(){ setTimeout(()=>document.getElementById('searchResults').classList.remove('show'), 140); }
    function selectSearch(id){ document.getElementById('searchInput').value=''; hideSearchResults(); showProductModal(id); }

    // 13) Skeleton helpers
    function showSkeleton(){ document.getElementById('skeletonGrid').classList.remove('hidden'); document.getElementById('productsGrid').classList.add('hidden'); }
    function hideSkeleton(){ document.getElementById('skeletonGrid').classList.add('hidden'); document.getElementById('productsGrid').classList.remove('hidden'); }

    // Filters and rendering
    function filterProducts(cat){
      currentFilter = cat;
      showSkeleton();
      setTimeout(()=>{
        const list = (cat==='all') ? products : products.filter(p=>p.category===cat);
        renderProducts(list);
        hideSkeleton();
        showPage('home');
      }, 550);
    }

    function renderProducts(list){
      const grid = document.getElementById('productsGrid');
      grid.innerHTML = list.map(p=>{
        const dp = p.discount ? p.price - p.price*p.discount/100 : p.price;
        const rate = avgRatingFor(p.id);
        return `
          <div class="card rounded-2xl overflow-hidden hover:cursor-pointer halo holo-border" onclick="showProductModal(${p.id})">
            <div class="relative">
              <img src="${p.image}" alt="${p.name}" class="w-full h-48 object-cover"
                   onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
              ${p.discount ? `<span class="badge-off absolute top-3 left-3 text-xs font-bold px-2 py-1 rounded-full">${p.discount}% OFF</span>`:''}
            </div>
            <div class="p-4">
              <div class="font-bold mb-1">${p.name}</div>
              <div class="flex items-center justify-between">
                <div>
                  ${p.discount? `<div class="text-xs text-[color:var(--muted)] line-through">$${p.price.toFixed(2)}</div>`:''}
                  <div class="neon font-extrabold">$${dp.toFixed(2)}</div>
                </div>
                <div class="text-xs stars">${stars(rate)} <span class="text-[color:var(--muted)]">(${(reviewsStore[p.id]||[]).length})</span></div>
              </div>
              <div class="mt-3 grid grid-cols-2 gap-2">
                <button class="btn btn-liquid w-full" onclick="event.stopPropagation(); addToCart(${p.id}, this)">Add to cart</button>
                <button class="btn-ghost rounded-xl py-2" onclick="event.stopPropagation(); showProductModal(${p.id})">Details</button>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderDeals(){
      const grid = document.getElementById('dealsGrid');
      const special = products.filter(p=>p.discount>15);
      grid.innerHTML = special.map(p=>{
        const dp = p.price - p.price*p.discount/100;
        return `
          <div class="card rounded-2xl overflow-hidden halo holo-border">
            <img src="${p.image}" alt="${p.name}" class="w-full h-44 object-cover"
                 onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
            <div class="p-4">
              <div class="font-bold mb-1">${p.name}</div>
              <div class="flex items-center gap-3">
                <div class="text-[color:var(--muted)] line-through">$${p.price.toFixed(2)}</div>
                <div class="neon font-extrabold">$${dp.toFixed(2)}</div>
              </div>
              <button class="btn btn-liquid w-full mt-3" onclick="addToCart(${p.id}, this)">Buy</button>
            </div>
          </div>
        `;
      }).join('');
    }

    // 8) Cart + Mini Cart + Fly-to-Cart
    function addToCart(id, el){
      const p = products.find(x=>x.id===id);
      const ex = cart.find(x=>x.id===id);
      if(ex) ex.quantity += 1; else cart.push({...p, quantity:1});
      updateCartUI(); notify('Added to cart üõí');
      if(el){ flyToCart(el, p.image); }
      showMiniCart(); setTimeout(hideMiniCart, 1400);
    }
    function updateCartUI(){
      const items = document.getElementById('cartItems');
      const totalEl = document.getElementById('cartTotal');
      const count = cart.reduce((t,i)=>t+i.quantity,0);
      document.getElementById('cartCount').textContent = count;

      if(cart.length===0){
        items.innerHTML = `<div class="text-center text-[color:var(--muted)] py-8">Your cart is empty</div>`;
        totalEl.textContent = '$0.00';
        updateMiniCartUI();
        return;
      }
      let total=0;
      items.innerHTML = cart.map(i=>{
        const dp = i.discount ? i.price - i.price*i.discount/100 : i.price;
        const t = dp*i.quantity; total += t;
        return `
          <div class="flex items-center justify-between border-b border-white/10 py-3">
            <div class="flex items-center gap-3 min-w-0">
              <img src="${i.image}" alt="${i.name}" class="w-16 h-16 rounded-lg object-cover"
                   onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
              <div class="min-w-0">
                <div class="font-bold truncate">${i.name}</div>
                <div class="neon font-extrabold text-sm">$${dp.toFixed(2)}</div>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <button class="chip w-8 h-8 rounded-full" onclick="changeQty(${i.id},-1)">-</button>
              <div class="px-3 py-1 rounded-full chip">${i.quantity}</div>
              <button class="chip w-8 h-8 rounded-full" onclick="changeQty(${i.id},1)">+</button>
              <button class="text-red-400 text-xl" onclick="removeFromCart(${i.id})">üóëÔ∏è</button>
            </div>
          </div>
        `;
      }).join('');
      totalEl.textContent = '$'+ total.toFixed(2);
      updateMiniCartUI();
    }
    function changeQty(id,d){
      const it = cart.find(x=>x.id===id);
      if(!it) return;
      it.quantity += d;
      if(it.quantity<=0) cart = cart.filter(x=>x.id!==id);
      updateCartUI();
    }
    function removeFromCart(id){ cart = cart.filter(x=>x.id!==id); updateCartUI(); }
    function placeOrder(){
      if(cart.length===0) return notify('Cart is empty');
      notify('Order placed ‚úÖ (Demo)');
      cart = [];
      updateCartUI();
    }

    function updateMiniCartUI(){
      const box = document.getElementById('miniCartItems');
      const total = cart.reduce((s,i)=> s + (i.discount? (i.price - i.price*i.discount/100):i.price)*i.quantity, 0);
      document.getElementById('miniCartTotal').textContent = '$'+ total.toFixed(2);
      if(cart.length===0){ box.innerHTML = `<div class="text-sm text-[color:var(--muted)] py-4 text-center">Cart is empty</div>`; return; }
      const shown = cart.slice(0,5);
      box.innerHTML = shown.map(i=>`
        <div class="flex items-center gap-2">
          <img src="${i.image}" class="w-10 h-10 rounded-lg object-cover"
               onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
          <div class="flex-1 min-w-0">
            <div class="truncate text-sm">${i.name}</div>
            <div class="text-xs text-[color:var(--muted)]">x${i.quantity}</div>
          </div>
          <div class="text-sm font-bold neon">$${(i.discount? i.price - i.price*i.discount/100 : i.price).toFixed(2)}</div>
        </div>
      `).join('') + (cart.length>5 ? `<div class="text-xs text-[color:var(--muted)] pt-1 text-center">+ ${cart.length-5} more</div>`:'');
    }
    function showMiniCart(){ const m=document.getElementById('miniCart'); m.classList.remove('hidden'); }
    function hideMiniCart(){ const m=document.getElementById('miniCart'); m.classList.add('hidden'); }

    function flyToCart(el, imgURL){
      const cartBtn = document.getElementById('cartBtn');
      if(!cartBtn) return;
      const start = el.getBoundingClientRect();
      const end = cartBtn.getBoundingClientRect();
      const ball = document.createElement('div');
      ball.style.position='fixed';
      ball.style.top = (start.top + start.height/2 - 16)+'px';
      ball.style.left = (start.left + start.width/2 - 16)+'px';
      ball.style.width='32px'; ball.style.height='32px'; ball.style.borderRadius='9999px';
      ball.style.background = `center/cover no-repeat url('${imgURL}')`;
      ball.style.boxShadow = '0 8px 20px rgba(0,229,255,.35)';
      ball.style.zIndex='90';
      document.body.appendChild(ball);
      const dx = (end.left + end.width/2) - (start.left + start.width/2);
      const dy = (end.top + end.height/2) - (start.top + start.height/2);
      ball.animate([
        { transform:'translate(0,0) scale(1)', opacity:1 },
        { transform:`translate(${dx*0.6}px, ${dy*0.6}px) scale(0.9)`, opacity:.9, offset:.7 },
        { transform:`translate(${dx}px, ${dy}px) scale(0.2)`, opacity:0 }
      ], { duration: 700, easing: 'cubic-bezier(.2,.8,.3,1)' }).onfinish = ()=> ball.remove();
    }

    // Product modal + reviews
    let modalQty = 1;
    function showProductModal(id){
      const p = products.find(x=>x.id===id);
      if(!p) return;
      modalQty = 1;
      const dp = p.discount ? p.price - p.price*p.discount/100 : p.price;
      const rList = reviewsStore[p.id] || [];
      const avg = avgRatingFor(p.id);

      const gallery = (p.images||[]).map((img,idx)=>`
        <img src="${img}" class="thumb ${idx===0?'active':''}" alt="${p.name}"
             onclick="changeMainImage('${img}', this)"
             onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
      `).join('');

      const specs = Object.entries(p.specifications||{}).map(([k,v])=>`
        <div class="flex items-center justify-between border-b border-white/10 py-2">
          <div class="text-[color:var(--muted)]">${k}</div>
          <div>${v}</div>
        </div>
      `).join('');

      const reviewsHTML = rList.length ? rList.map(rv=>`
        <div class="rounded-xl p-3 border border-white/10 mb-2">
          <div class="flex items-center justify-between">
            <div class="font-extrabold">${rv.userName || 'Anonymous'}</div>
            <div class="text-xs text-[color:var(--muted)]">${rv.date}</div>
          </div>
          <div class="stars mt-1 text-sm">${stars(rv.rating||5)}</div>
          <div class="mt-2 leading-7">${escapeHTML(rv.comment||'')}</div>
        </div>
      `).join('') : `<div class="text-[color:var(--muted)] text-center py-6">No reviews yet. Be the first!</div>`;

      const addReviewUI = displayName
        ? `
          <form onsubmit="event.preventDefault(); submitReview(${p.id});" class="mt-4 rounded-xl border border-white/10 p-3">
            <div class="font-extrabold mb-1">${displayName}</div>
            <div class="flex items-center gap-3 mb-2">
              <label class="text-sm text-[color:var(--muted)]">Rating:</label>
              <select id="reviewRating" class="input rounded-lg px-2 py-1 text-sm w-24">
                <option value="5">5</option><option value="4">4</option><option value="3">3</option><option value="2">2</option><option value="1">1</option>
              </select>
            </div>
            <textarea id="reviewText" class="input rounded-xl w-full h-24" placeholder="Your review..." required></textarea>
            <button class="btn btn-liquid w-full mt-2">Submit review</button>
          </form>
        `
        : `
          <div class="rounded-xl p-3 border border-yellow-500/30 bg-yellow-500/10 text-yellow-100 text-sm mt-4">
            Set your display name (sign up) to write a review.
            <button class="underline ml-1" onclick="openSignup()">Open signup</button>
          </div>
        `;

      const html = `
        <div class="grid lg:grid-cols-2 gap-6">
          <div>
            <img id="mainImage" src="${(p.images||[])[0]||p.image}" alt="${p.name}" class="w-full h-72 object-cover rounded-xl"
                 onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
            <div class="flex items-center gap-2 mt-3 overflow-x-auto">${gallery}</div>
          </div>
          <div>
            <div class="text-2xl font-extrabold neon mb-1">${p.name}</div>
            <div class="text-xs stars mb-3">${stars(avg)} <span class="text-[color:var(--muted)]">(${rList.length} reviews)</span></div>
            <div class="mb-3">
              ${p.discount? `<div class="text-[color:var(--muted)] line-through">$${p.price.toFixed(2)}</div>`:''}
              <div class="text-3xl font-extrabold neon">$${dp.toFixed(2)}</div>
            </div>
            <div class="leading-7 mb-4">${p.description || ''}</div>
            <div class="flex items-center gap-3 mb-4">
              <span class="text-[color:var(--muted)]">Qty:</span>
              <button class="chip w-8 h-8 rounded-full" onclick="changeModalQty(-1)">-</button>
              <div id="modalQty" class="chip px-3 py-1 rounded-full">1</div>
              <button class="chip w-8 h-8 rounded-full" onclick="changeModalQty(1)">+</button>
            </div>
            <div class="grid sm:grid-cols-2 gap-3">
              <button class="btn btn-liquid" onclick="addToCartWithQty(${p.id}, this)">Add to cart</button>
              <button class="btn-ghost rounded-xl py-3" onclick="addToCartWithQty(${p.id}, this); showPage('cart'); closeProductModal();">Buy now</button>
            </div>
          </div>
        </div>

        <div class="mt-6">
          <h4 class="text-lg font-extrabold text-[var(--accent)] mb-2">Specifications</h4>
          <div class="rounded-xl border border-white/10 p-3">
            ${specs || '<div class="text-[color:var(--muted)] text-sm">No specifications</div>'}
          </div>
        </div>

        <div class="mt-6">
          <h4 class="text-lg font-extrabold text-[var(--accent)]">Customer reviews</h4>
          ${addReviewUI}
          <div class="mt-4">${reviewsHTML}</div>
        </div>
      `;
      document.getElementById('productModalContent').innerHTML = html;
      openModal('productModal');
    }
    function closeProductModal(){ closeModal('productModal'); }
    function changeMainImage(src, el){
      const img = document.getElementById('mainImage');
      if(img){ img.src = src; }
      document.querySelectorAll('.thumb').forEach(t=>t.classList.remove('active'));
      el.classList.add('active');
    }
    function changeModalQty(d){ modalQty = Math.max(1, modalQty + d); document.getElementById('modalQty').textContent = modalQty; }
    function addToCartWithQty(id, el){
      const p=products.find(x=>x.id===id);
      const ex=cart.find(x=>x.id===id);
      if(ex) ex.quantity += modalQty; else cart.push({...p, quantity:modalQty});
      updateCartUI(); notify('Added to cart üõí');
      if(el) flyToCart(el, p.image);
      showMiniCart(); setTimeout(hideMiniCart, 1400);
    }
    function submitReview(productId){
      if(!displayName){ return notify('Sign up first to review ‚ö†Ô∏è'); }
      const rating = parseInt(document.getElementById('reviewRating').value,10) || 5;
      const text = (document.getElementById('reviewText').value || '').trim();
      if(!text) return;
      const dateStr = new Date().toISOString().slice(0,10);
      const list = reviewsStore[productId] || [];
      list.unshift({ userName: displayName, rating, date: dateStr, comment: text });
      reviewsStore[productId] = list;
      localStorage.setItem('reviewsStore', JSON.stringify(reviewsStore));
      notify('Review submitted ‚úÖ');
      showProductModal(productId);
      const listNow = (currentFilter==='all') ? products : products.filter(p=>p.category===currentFilter);
      renderProducts(listNow);
    }

    // Signup Wizard
    let selected = {name:'‚Äî', dial:'+‚Äî', flag:'üè≥Ô∏è'};
    function openSignup(){
      document.getElementById('signupModal').classList.add('show');
      goStep(1);
      renderCountries(countries);
      const cs = document.getElementById('countrySearch'); if(cs) cs.value='';
      hideCountryMenu();
    }
    function closeSignup(){ document.getElementById('signupModal').classList.remove('show'); }

    function toggleCountryMenu(e){ e.preventDefault(); const m=document.getElementById('countryMenu'); m.classList.toggle('hidden'); }
    function hideCountryMenu(){ const m=document.getElementById('countryMenu'); if(m) m.classList.add('hidden'); }

    function renderCountries(list){
      const box = document.getElementById('countryList');
      box.innerHTML = list.map(c=>`
        <button class="w-full text-left px-3 py-2 hover:bg-white/5 flex items-center gap-2" onclick='selectCountry(${JSON.stringify(c).replace(/"/g,"&quot;")})'>
          <span class="flag">${c.flag}</span>
          <span class="flex-1">${c.name}</span>
          <span class="text-xs chip rounded-full px-2 py-0.5">${c.dial}</span>
        </button>
      `).join('');
    }
    function filterCountries(q){
      const t = (q||'').toLowerCase();
      const list = countries.filter(c=> c.name.toLowerCase().includes(t));
      renderCountries(list);
    }
    function selectCountry(c){
      selected = c;
      document.getElementById('selFlag').textContent = c.flag;
      document.getElementById('selCountry').textContent = c.name;
      document.getElementById('selDial').textContent = c.dial;
      hideCountryMenu();
    }
    // Close menu when clicking outside
    document.addEventListener('click', (e)=>{
      const btn = document.getElementById('countryDropdownBtn');
      const menu = document.getElementById('countryMenu');
      if(!btn || !menu) return;
      if(!btn.contains(e.target) && !menu.contains(e.target)) hideCountryMenu();
    });

    function goStep(n){
      ['step1','step2','step3'].forEach((id,i)=>{
        document.getElementById(id).classList.toggle('hidden', (i+1)!==n);
      });
      [1,2,3].forEach(i=> document.getElementById('dot'+i).classList.toggle('active', i<=n));
    }

    function nextFromStep1(){
      const phone = (document.getElementById('phoneInput').value||'').trim();
      if(!selected || !selected.dial || selected.dial==='+‚Äî'){ return notify('Please select a country'); }
      if(!/^[0-9]{6,15}$/.test(phone)){ return notify('Enter a valid phone number'); }
      goStep(2);
    }
    function prevToStep1(){ goStep(1); }

    function nextFromStep2(){
      const email = (document.getElementById('emailInput').value||'').trim();
      if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){ return notify('Enter a valid Gmail'); }
      goStep(3);
    }
    function prevToStep2(){ goStep(2); }

    function finishSignup(){
      const name = (document.getElementById('nameInput').value||'').trim();
      const phone = (document.getElementById('phoneInput').value||'').trim();
      const email = (document.getElementById('emailInput').value||'').trim();
      if(!name) return notify('Enter your display name');

      currentUser = { country:selected.name, flag:selected.flag, dial:selected.dial, phone: phone, email: email, name: name };
      displayName = name; // enable reviews
      // Update navbar labels to Account Settings
      document.getElementById('accountNav').textContent = 'Account Settings';
      document.getElementById('accountBtn').textContent = 'Account Settings';

      notify('Welcome, '+name+' ‚ú® (Welcome email sent - demo)');
      closeSignup();
      showPage('home');
    }

    function fillAccountSettings(){
      if(!currentUser){ return; }
      document.getElementById('accCountry').value = `${currentUser.flag} ${currentUser.country} (${currentUser.dial})`;
      document.getElementById('accPhone').value = currentUser.phone || '';
      document.getElementById('accEmail').value = currentUser.email || '';
      document.getElementById('accName').value = currentUser.name || '';
    }

    function saveAccountSettings(){
      if(!currentUser){ return openSignup(); }
      const phone = (document.getElementById('accPhone').value||'').trim();
      const email = (document.getElementById('accEmail').value||'').trim();
      const name  = (document.getElementById('accName').value||'').trim();
      if(!/^[0-9]{6,15}$/.test(phone)) return notify('Enter a valid phone');
      if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) return notify('Enter a valid email');
      if(!name) return notify('Enter your name');

      currentUser.phone = phone; currentUser.email = email; currentUser.name = name;
      displayName = name; // keep reviews name in sync
      notify('Changes saved successfully ‚úÖ');
    }

    function signOut(){
      currentUser = null;
      displayName = '';
      document.getElementById('accountNav').textContent = 'Profile (Demo)';
      document.getElementById('accountBtn').textContent = 'Account';
      notify('Signed out');
      showPage('home');
    }

    // Modal helpers
    function openModal(id){ document.getElementById(id).classList.add('show'); document.body.style.overflow='hidden'; }
    function closeModal(id){ document.getElementById(id).classList.remove('show'); document.body.style.overflow='auto'; }

    // Banner slider with 1) Parallax layers and particles
    const slides = [
      { img:'https://images.unsplash.com/photo-1498049794561-7780e7231661?w=1600', title:'Tech that shines', subtitle:'Latest devices at special prices', c1:'electronics' },
      { img:'https://images.unsplash.com/photo-1483985988355-763728e1935b?w=1600', title:'Style & Fashion', subtitle:'Fresh looks for every season', c1:'fashion' },
      { img:'https://images.unsplash.com/photo-1516979187457-637abb4f9353?w=1600', title:'Books & Learning', subtitle:'Expand your mind with best picks', c1:'books' }
    ];
    let currentSlide = 0;
    let slideTimer;
    function renderSlides(){
      const wrap = document.getElementById('banner');
      wrap.innerHTML = slides.map((s,idx)=>`
        <div class="absolute inset-0 ${idx===0?'opacity-100':'opacity-0'} transition-opacity duration-700" data-slide="${idx}">
          <img src="${s.img}" alt="${s.title}" class="w-full h-full object-cover"
               onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
          <div class="absolute inset-0 bg-gradient-to-t from-black/50 via-black/20 to-transparent"></div>
          <div class="absolute bottom-6 left-6" data-parallax="layer" data-depth="0.25">
            <div class="text-3xl sm:text-4xl font-extrabold neon">${s.title}</div>
            <div class="text-sm sm:text-base text-[color:var(--muted)] mt-1">${s.subtitle}</div>
            <div class="mt-3 flex gap-2">
              <button class="btn btn-liquid px-4 py-2" onclick="filterProducts('${s.c1}')">Shop now</button>
              <button class="btn-ghost rounded-xl px-4 py-2" onclick="showPage('deals')">View deals</button>
            </div>
          </div>
        </div>
      `).join('');

      const dots = document.getElementById('dots');
      dots.innerHTML = slides.map((_,i)=>`
        <button class="w-2.5 h-2.5 rounded-full ${i===0?'bg-[var(--accent)]':'bg-white/30'}"
                aria-label="Go to slide ${i+1}" onclick="goSlide(${i})"></button>
      `).join('');

      startAutoSlide();
      initParallax();
      startParticles();
    }
    function startAutoSlide(){ clearInterval(slideTimer); slideTimer = setInterval(()=> nextSlide(), 4200); }
    function goSlide(i){
      const nodes = [...document.querySelectorAll('[data-slide]')];
      nodes.forEach((n,idx)=> n.style.opacity = (idx===i?'1':'0'));
      const dots = document.getElementById('dots')?.children;
      if(dots){
        for(let k=0;k<dots.length;k++){
          dots[k].classList.toggle('bg-[var(--accent)]', k===i);
          dots[k].classList.toggle('bg-white/30', k!==i);
        }
      }
      currentSlide = i; startAutoSlide();
    }
    function nextSlide(){ goSlide((currentSlide+1)%slides.length); }
    function prevSlide(){ goSlide((currentSlide-1+slides.length)%slides.length); }

    // 1) Parallax interaction
    function initParallax(){
      const banner = document.getElementById('banner');
      banner.onmousemove = (e)=>{
        const rect = banner.getBoundingClientRect();
        const x = (e.clientX - rect.left)/rect.width - .5;
        const y = (e.clientY - rect.top)/rect.height - .5;
        banner.querySelectorAll('[data-parallax="layer"]').forEach(el=>{
          const depth = parseFloat(el.getAttribute('data-depth'))||0.2;
          el.style.transform = `translate(${x*20*depth}px, ${y*20*depth}px)`;
        });
      };
      banner.onmouseleave = ()=> banner.querySelectorAll('[data-parallax="layer"]').forEach(el=> el.style.transform='translate(0,0)');
    }

    // 1) Particles canvas
    let particles=[], rafId=null;
    function startParticles(){
      const c = document.getElementById('particleLayer');
      const ctx = c.getContext('2d');
      const resize=()=>{ c.width=c.offsetWidth; c.height=c.offsetHeight; };
      resize();
      particles = Array.from({length: 40}, ()=>({
        x: Math.random()*c.width, y: Math.random()*c.height,
        r: Math.random()*2+0.5, vx:(Math.random()-.5)*0.3, vy:(Math.random()-.5)*0.3
      }));
      function step(){
        ctx.clearRect(0,0,c.width,c.height);
        particles.forEach(p=>{
          p.x+=p.vx; p.y+=p.vy;
          if(p.x<0||p.x>c.width) p.vx*=-1;
          if(p.y<0||p.y>c.height) p.vy*=-1;
          const g = ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.r*6);
          g.addColorStop(0,'rgba(0,229,255,.35)');
          g.addColorStop(1,'rgba(0,229,255,0)');
          ctx.fillStyle=g; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
        });
        rafId=requestAnimationFrame(step);
      }
      cancelAnimationFrame(rafId); step();
      window.addEventListener('resize', resize);
    }

    // Utils
    let notifyTimer;
    function notify(text){
      const n = document.getElementById('notify');
      n.textContent = text; n.classList.add('show');
      clearTimeout(notifyTimer);
      notifyTimer = setTimeout(()=> n.classList.remove('show'), 2200);
    }
    function escapeHTML(str){ return str.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;' }[m])); }

    // Init
    function init(){
      enrichProducts();
      renderSlides();
      // Skeleton first, then real products
      showSkeleton();
      setTimeout(()=>{ renderProducts(products); hideSkeleton(); }, 700);
      // Initial reveals
      document.querySelectorAll('#home .reveal').forEach((n,i)=> setTimeout(()=> n.classList.add('show'), 80*i));
    }
    init();
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'984b4b2995ed5d93',t:'MTc1ODgxMTQwNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
